## Cookies & Session

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * Cookies 的作用
 * 
 * 存储于: 浏览器
 * 
 * 优点: 保持账号在同一域名中不同页面的登陆状态
 */


如果我们用 JS 变量存储数据，那么在页面关闭时，数据就消失了

保持账号在同一域名中不同页面的登陆状态                     

按照正常的 HTTP 协议无法实现( HTTP协议: 上下文无关协议 )


=> Cookie( 前端页面中，持久化存储数据 )

    Cookie 存储在浏览器中，并非存储在某个页面中
    
    Cookie 可长期或设置限定时间存储于浏览器中
    
    Cookie 仅作用于 同一域名下的 不同页面


//-------------------------------------------------------------------------------------------------------------------//


/**
 * 如何获取 Cookies
 * 
 * 存储于: 浏览器
 * 
 * 缺点: 若他人复制了浏览器中的 Cookie，则可以伪装成用户登陆其账号
 */

初始状态: 未登陆

访问百度登陆，并且输入了正确的 账号 和 密码

=> Cookie( 存储加密的用户基本信息 ) 存储于 浏览器

    百度的后端会向这个域名下，返回一个 Cookies( 存储加密的用户基本信息 )交由浏览器存储
    
    之后的每次请求，浏览器会自动添加当前域名下的 Cookies
    
    后端接收到 Cookie( 存储加密的用户基本信息 )，
    
    若解析成功，则可以获取真正的用户信息


//-------------------------------------------------------------------------------------------------------------------//


/**
 * Session
 * 
 * 存储于: 服务器
 * 
 * 缺点:服务器端需要存储大量的信息( 消耗资源 )等 ...
 */

初始状态: 未登陆

访问百度登陆，并且输入了正确的 账号 和 密码

=> Session( 存储用户基本信息 ) 存储于 服务器

    只要页面不关闭，就会一直保持这登陆关系
    
    缺点: 如果用户量较大( 上亿用户 )，服务端会很耗资源( Session 是存储于 内存上 )
    
         因为后端可能不止一台服务器( 用户的登陆信息，只存在其中一台服务器中 )
         因为用户的登陆操作在哪台服务器上执行，则用户的登陆信息就存在哪台服务器中
         
         反向代理( 后端操作 ): 轮询 -> 请求依次分配给每台服务器
         
                            IP哈希 -> 通过 IP 地址，把请求分配给具有相同 IP 地址的 服务器
    

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### Cookie

> HTTP 很重要的一个特点 `无状态`( 每次见面都是 `初次见面`)
> 如果希望服务端程序去记住每个访问的访客是不可能的
> 必须借助一些手段或者技巧让服务端记住客户端，这种手段就是`Cookie`


``` vim


+ -------- +                                           + -------- + 
|          |                                           |          |
|          |                                           |          |
|          | ----------------------------------------> |          |
|          |                                           |          |
|          | GET http://www.example.com/ HTTP/1.1      |          |
|          |                                           |          |
|          |                                           |          |
|          | <---------------------------------------- |          |
|          |                                           |          |
|  Client  | HTTP/1.1 200 OK                           |  Server  |
|          | set-cookie: session-id=12345;             |          |
|          |                                           |          |
|          |                                           |          |
|          | ----------------------------------------> |          |
|          |                                           |          |
|          | GET http://www.example.com/ HTTP/1.1      |          |
|          | cookie: session-id=12345;                 |          |
|          |                                           |          |
|          |                                           |          |
+ -------- +                                           + -------- + 


```

#### Session

> 本地造假 cookie

``` javascript


var dt = new Date();

dt.setYear(2018);

document.cookie = 'app-installed=1; expires=' + dt.toGMTSring();


```

> Cookie 是服务器给客户由 `客户端本地保存`，客户可以在本地随意操作( 删除/修改 )
> 也可以伪造假 Cookie，对于服务端是无法辨别的，会造成 服务端被蒙蔽，构成`安全隐患`
> Session 是 Cookie 升级版


``` js
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


                        + ------------------------------------------------------------------------------------- + 
                        |                                                                                       |
                        |                                                                                       |
                        |       Server                                                                          |
                        |                                                                                       |
                        |                        + ------------------------------------------------ +           |
                        |                        |                                                  |           |
+ ---------- +          |                        |                       Session                    |           |
|            |                                   |                                                  |           |
|            |      Cookie session_id=0x001      + ---------------- + ------------- + ------------- +           |      
|  client1   |---------------------------------> |  0x001           |  0x002        |  0x003        |           |
|            |          |                        + ---------------- + ------------- + ------------- +           | 
|            |          |                        | key1: hello      |  key1: some   |  key1:may     |           |
+ ---------- +          |                        + ---------------- + ------------- + ------------- +           |
+ ---------- +          |                        | key2: world      |  key2: time   |               |           |
|            |                                   + ---------------- + ------------- + ------------- +           |
|            |      Cookie session_id=0x002      |                  |  key3: ok     |               |           |
|  client2   |---------------------------------> + ---------------- + ------------- + ------------- +           |
|            |          |                        |                                                  |           |
|            |          |                        + ---------------- + ------------- + ------------- +           |
+ ---------- +          |                        |  0x004           |   0x005       |  0x006        |           |
+ ---------- +          |                        + ---------------- + ------------- + ------------- +           |
|            |                                   |  who             |               |               |           |                               
|            |      Cookie session_id=0x003      + ---------------- + ------------- + ------------- +           |         
|  client3   |---------------------------------> |                  |               |               |           |
|            |          |                        + ---------------- + ------------- + ------------- +           |
|            |          |                        |                  |               |               |           |
+ ---------- +          |                        + ---------------- + ------------- + ------------- +           |
                        |                        |                  |               |               |           |
                        |                        +------------------------------------------------- +           |
                        |                                                                                       |
                        |                                                                                       |
                        |                                                                                       |
                        + ------------------------------------------------------------------------------------- +
                                

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```



__Session 与 Cookie 区别__

> Cookie 数据存放在`浏览器`，Session 数据存放在`服务器`
> 用户无法修改客户端数据，所以相对安全

``` php


//帮助用户找箱子( 有则进入，无则创建 )
session_start();


//设置 session
$_SESSION['key'] = 'value';


```













