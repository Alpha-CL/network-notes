# principle

### principle

#### nginx( reverse proxy )

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


        + ---- Browser -------- +                       + ------- DNS --------- +
        |                       |    request domain     |                       |
        |                       |                       |                       |
        |     www.demo.com    --------- step_1 ----------->  Resolve domain     |
        |                       |                       |                       |
        |   requset res of ip <-------- step_2 ------------  xxx.xxx.xxx.xxx    |
        |                       |                       |                       |
        |       |      /|\      |      return ip        |                       |
        |       |       |       |                       |                       |
        + ----- | ----- | ----- +                       + --------------------- +
                |       |                                                        
   request res -|       |                                                        
                |       |               1. 根据域名请求 DNS 服务器
                |       |               2. DNS 服务器返回 域名对应的 IP              
              step_3  step_4            3. 根据 IP 请求对应服务器              
                |       |               4. 服务器接收到请求( 利用 反向代理 解决 跨域请求数据 )
                |       |                   4.1 静态资源请求  http://demo.com -> nginx -> rootdir -> index.html
                |       |                   4.2 数据接口请求  http://demo.com/api -> nginx -> nodejs -> mysql
                |       |                                                    ( reverse proxy )
                |       |                   
                |       |- response res         
                |       |                       
        + ----- | ----- | --------------------------------------- Web Server ------------------------------ +
        |       |       |                                                                                   |
        |       |       |                       + ----------------- static resources ------------------ +   |
        |      \|/      |                       |                                                       |   |
        |   + ------ webSer --- +               |              + ---- {domain1: webRootDir} ----- +     |   |
        |   |                   |               |              |                                  |     |   |
        |   |                   |               |     + ------ +      index.hmtl, ...             |     |   |
        |   |   Nginx           |               |     |        |                                  |     |   |
        |   |   Apache          |               |     |        + -------------------------------- +     |   |
        |   |   ...             |               |     |                                                 |   |
        |   |                   |               |     |        + ---- {domain2: webRootDir} ----- +     |   |
        |   |   port: 80/443    |               |     |        |                                  |     |   |
        |   |                   |   html <----------- + ------ +     index.hmtl, ...              |     |   |
        |   |                   |               |     |        |                                  |     |   |
        |   + ----------------- +               |     |        + -------------------------------- +     |   |
        |           |  /|\                      |     |                                                 |   |
        |           |   |                       |     |        + ---- {domain3: webRootDir} ----- +     |   |
        |           |   |                       |     |        |                                  |     |   |
        |           |   |                       |     + ------ +      index.hmtl, ...             |     |   |
        |           |   |                       |              |                                  |     |   |
        |           |   |                       |              + -------------------------------- +     |   |
        |       "reverse proxy"                 |                                                       |   |
        |           |   |                       |                           ... ...                     |   |
        |           |   |                       |                                                       |   |
        |           |   |                       + ----------------------------------------------------- +   |
        |          \|/  |                                                                                   |
        |   + ----------------- +               + ------------------- database ------------------------ +   |
        |   |                   |               |                                                       |   |
        |   |                   |               |                                                       |   |
        |   |    nodejs         |               |         mysql, mangodb ...                            |   |
        |   |    java           | ------------> |                                                       |   |
        |   |    php            |     data      |                                                       |   |
        |   |    ...            | <------------ |                                                       |   |
        |   |                   |               |                                                       |   |
        |   |    port: [any]    |               |                                                       |   |
        |   |                   |               |                                                       |   |
        |   |                   |               |                                                       |   |
        |   + ----------------- +               + ----------------------------------------------------- +   |
        |                                                                                                   |
        + ------------------------------------------------------------------------------------------------- +


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### nodejs( jsonp / header.core ... )

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


        + ---- Browser -------- +                       + ------- DNS --------- +
        |                       |    request domain     |                       |
        |                       |                       |                       |
        |     www.demo.com    --------- step_1 ----------->  Resolve domain     |
        |                       |                       |                       |
        |   requset res of ip <-------- step_2 ------------  xxx.xxx.xxx.xxx    |
        |                       |                       |                       |
        |       |      /|\      |      return ip        |                       |
        |       |       |       |                       |                       |
        + ----- | ----- | ----- +                       + --------------------- +
                |       |                                                        
   request res -|       |                                                        
                |       |               1. 根据域名请求 DNS 服务器
                |       |               2. DNS 服务器返回 域名对应的 IP              
              step_3  step_4            3. 根据 IP 请求对应服务器              
                |       |               4. 服务器接收到请求( 跨域请求数据 ( jsonp / header.cors ) )
                |       |                   4.1 页面资源请求 http://demo.com:80/443
                |       |                       - 将 静态资源模版 与 数据 结合，返回完整的 html 页面模版
                |       |                   
                |       |                   *  数据接口请求 http://demo.com:3000
                |       |- response res         
                |       |                       
        + ----- | ----- | --------------------------------------- Web Server ------------------------------ +
        |       |       |                                                                                   |
        |       |       + ---- +                + -------------- static html template ----------------- +   |
        |      \|/             |                |                                                       |   |
        |   + ------ webSer -- | -- +           |              + ---- {domain1: webRootDir} ----- +     |   |
        |   |                  |    |           |              |                                  |     |   |
        |   |                  |    |           |     + ------ +      index.hmtl, ...             |     |   |
        |   |   nodejs         |    |           |     |        |                                  |     |   |
        |   |   java           |    |           |     |        + -------------------------------- +     |   |
        |   |   php            |    |           |     |                                                 |   |
        |   |   ...            |    |           |     |        + ---- {domain2: webRootDir} ----- +     |   |
        |   |                  |    |           |     |        |                                  |     |   |
        |   |   port: [any]    |    | template <----- + ------ +     index.hmtl, ...              |     |   |
        |   |                  |    |    |      |     |        |                                  |     |   |
        |   |                  |    |    |      |     |        + -------------------------------- +     |   |
        |   |           + ---- +    |    |      |     |                                                 |   |
        |   |           |           |    |      |     |        + ---- {domain3: webRootDir} ----- +     |   |
        |   |           |           |    |      |     |        |                                  |     |   |
        |   |   + --- mixin --- +   |    |      |     + ------ +      index.hmtl, ...             |     |   |
        |   |   |               |   |    |      |              |                                  |     |   |
        |   |   |               |   |    |      |              + -------------------------------- +     |   |
        |   |   |               |   |    |      |                                                       |   |
        |   |   |               |   |    |      |                           ... ...                     |   |
        |   |   |               |   |    |      |                                                       |   |
        |   |   |   dataTemp    |   |    |      + ----------------------------------------------------- +   |
        |   |   |               |   |    |                                                                  |
        |   |   |      /|\      | <----- +      + ------------------- database ------------------------ +   |
        |   |   |       |       |   |           |                                                       |   |
        |   |   |       |       |   |           |                                                       |   |
        |   |   |  temp + data  |   |           |         mysql, mangodb ...                            |   |
        |   |   |               | ------------> |                                                       |   |
        |   |   |               |   |   data    |                                                       |   |
        |   |   |               | <------------ |                                                       |   |
        |   |   |               |   |           |                                                       |   |
        |   |   |               |   |           |                                                       |   |
        |   |   + ------------- +   |           |                                                       |   |
        |   |                       |           |                                                       |   |
        |   + --------------------- +           + ----------------------------------------------------- +   |
        |                                                                                                   |
        + ------------------------------------------------------------------------------------------------- +


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### nginx vs nodejs

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 前后端不分离运行运行流程
 * 
 * 
 ** 服务器端将 数据与静态页面模版 组合，返回 组合好的 html 数据模版
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * 前后端分离运行运行流程
 * 
 * 
 * 服务器 返回数据，前端根据数据渲染页面
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### resolve domain

#### type

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * IP direction         // IP指向/记录类型
 * 
 * 
 * 
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


Address( A )                            // 将域名指向一个 IPV4 地址


CNAME                                   // 将域名指向另一个域名

AAAA                                    // 将域名指向一个 IPV6 地址



Name Server( NS )                       // 将子域名指向其他DNS服务器解析

Mail Exchanger( MX )                    // 将域名指向邮件服务器地址

SRV                                     // 记录提供特定的服务的服务器

TXT                                     // 文本长度限制512，通常做SPF记录( 反垃圾邮件 )

CAA                                     // CA证书办法机构授权效验


... ...


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### domain prefix

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 域名解析 前缀
 * 
 * 
 * 
 */

[prefix].domain.com


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


www:        解析后的域名为 www.aliyun.com

@:          直接解析主域名 aliyun.com

*:          泛解析，匹配其他所有域名 *.aliyun.com


mail:       将域名解析为 mail.aliyun.com，通常用于解析邮箱服务器

二级域名:     eg: abc.aliyun.com，填写 abc

手机网站:     eg: m.aliyun.com，填写 m 

显性URL:     不支持泛解析( 泛解析: 将所有子域名解析到同一地址 )


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### test domain

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// 测试域名是否根据解析规则返回 IP            


cmd: nslookup [domain]

=> ip                           // duration: 10min


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```




